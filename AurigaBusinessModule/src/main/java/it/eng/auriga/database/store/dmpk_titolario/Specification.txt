1        PACKAGE DMPK_TITOLARIO AUTHID CURRENT_USER IS
2        
3        	/****************************************************		INFORMAZIONI GENERALI		*******************************************************/
4        	/************** Argomenti delle stored per il controllo della transazione:											*******/
5        	/************** FlgRollBckFullIn -> se 1 in caso di errore viene fatta la rollback completa (non a savepoint), 					*******/
6        	/************** 				altrimenti la rollback delle sole modifiche effettuate nella stored						*******/
7        	/************** 				ATTENZIONE: la rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log			*******/
8        	/************** FlgAutoCommitIn  -> se vale 1, dopo la rollback e qualunque sia l'esito (positivo o no), la stored esegue una commit finale *****/
9        	/************** Tutte le funzioni/procedure che NON hanno gli argomenti in input FlgRollBckFullIn e FlgAutoCommitIn 				*******/
10        	/************** NON ESEGUONO AL LORO INTERNO ALCUNA COMMIT nè ROLLBACK 												*******/
11        
12        	/************** Tutte le funzioni, tranne quelle da utilizzarsi nelle select, restituiscono 1 in caso di successo, altrimenti 0		*******/
13        	/************** Tali funzioni restituiscono, in caso di result 0, un n.ro, un contesto e un messaggio di errore:					*******/
14        	/************** il n.ro è: <0 se errore ORACLE non specificamente gestito 											*******/
15        	/**************		   da 1->1000 errore "grave" (SEVERE_ERROR) gestito											*******/
16        	/**************		   >1000 errore non grave gestito														*******/
17        	/************** il contesto indica il package e/o funzione/procedura in cui si è verificato l'errore							*******/
18        
19        	/********** funzione per ottenere l'id. del piano di classificazione usato da un dato soggetto prod./AOO ad un dato timestamp **********/
20        	function GetIdPianoClassifSpAOO(
21        			IdSpAOOIn		IN		DMT_SOGGETTI_PROD_AOO.ID_SP_AOO%type,	-- (obblig) Id. del soggetto produttore o AOO per cui trovare il piano di classificazione
22        			TsRifIn			IN		DATE DEFAULT sysdate					-- Data e ora a cui ricavare il piano di classificazione
23        																			-- se non specificata si intende sysdate
24        			) return DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type;				-- Id. del piano di classificazione
25        																			-- in caso di errore o se non c'è il piano è NULL
26        
27        	/************* funzione per convertire i NRI_LIVELLI di una classificazione dalla forma in cui appaiono in tabella a quella con cui vanno renderizzati nella GUI *************/
28        	function ConvertNriLivelliTitXGUI(
29        			NriLivelliTitInTableIn		IN		DMT_TITOLARIO.NRI_LIVELLI%type,		-- (obblig.) Campo NRI_LIVELLI della classificazione come compare in tabella
30        			DefLivelliTitTabIn		IN		DMTO_LIV_GERARCHIA,				-- (obblig.)Definizione di quali sono i livelli del titolario cui appartiene la classificazione
31        			SepLivelliIn			IN		VARCHAR2,						-- (obblig.)Separatore dei livelli da usare nell GUI
32        			FlgPaddingLivTitIn 		IN		PLS_INTEGER,					-- (valori 1/0/NULL) Se 1 significa che per il livelli numerici va fatto il riempimento con 0 fino alla max lunghezza di un n.ro livello (LengthNroLivelloIn)
33        			LengthNroLivelloIn		IN		PLS_INTEGER						-- (obblig.)Max lunghezza (come n.ro di cifre o caratterri) di ciascun n.ro livello
34        			) return VARCHAR2;											-- N.ri livello della classificazione come devono essere renderizzati nella GUI
35        
36        	/******* funzione per ricercare nel titolario di classificazione ********/
37        	function TrovaInTitolario(
38        			CodIdConnectionTokenIn		IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
39        																	-- (obblig). Codice identificativo del token di connessione
40        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,	-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
41        			FlgPreimpostaFiltroIn		IN 		PLS_INTEGER DEFAULT NULL,			-- (valori 1/0/NULL) Se vale 1 i filtri e l'ordinamento vengono settati secondo le impostazioni dell'utente di lavoro, altrimenti restano come passati in input
42        			MatchByIndexerIn			IN		CLOB DEFAULT NULL,				-- Lista delle classificazioni che sono state trovate dal searcher di Lucene (XML conforme a schema LISTA_STD.xsd)
43        																	-- Ogni oggetto di Lucene trovato è un tag Riga che contiene le seguenti colonne:
44        																	-- 1: identificativo dell¿oggetto
45        																	-- 2: non utilizzata
46        																	-- 3: flag 1/0 che indica se il match dell'oggetto richiede attributi "protetti", ovvero che possono contenere dati riservati
47        																	-- 4: score restituito da Lucene
48        			FlgIndexerOverflowIn		IN		PLS_INTEGER DEFAULT NULL,			-- (valori 1/0/NULL) Se 1 significa che il searcher di Lucene ha trovato un numero di oggetti superiore ad un limite massimo consentito.
49        																	-- Nel caso il flag valga 1 l¿argomento precedente può essere vuoto o se non lo è il suo contenuto viene comunque ignorato
50        			Flg2ndCallIn			IN		PLS_INTEGER DEFAULT NULL,			-- (valori 1/0/NULL) Se 1 indica che si tratta della seconda chiamata alla stored che viene fatta a seguito di una ricerca sottomessa.
51        																	-- Può essere 1 solo se MatchByIndexerIn contiene degli oggetti.
52        																	-- E' un flag che serve per velocizzare la ricerca: infatti quando è 1 i filtri vengono ignorati in quanto si considera che il set restituito dall'indicizzatore sia già fatto di oggetti soddisfacenti tutti i filtri; la chiamata alla stored serve solo per verificare l'accesso agli oggetti restituiti dall'indicizzatore, ordinare ed eventualmente paginare il risultato e calcolare tutti i dati degli oggetti da restituire.
53        			CercaInClassificazioneIO	IN OUT	DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,	-- 1° filtro di ricerca: id. della classificazione in cui effettuare la ricerca. Se non specificato si cerca in tutto il titolario
54        			FlgCercaInSubClassifIO		IN OUT	PLS_INTEGER,					-- 2° filtro di ricerca (valori 1/0/NULL): 1 indica che la ricerca va estesa alle sotto-classifiche della classificazione CercaInClassificazioneIO
55        																	-- ATTENZIONE: non può essere 1 se CercaInClassificazioneIO non è valorizzato
56        																	--		   Se CercaInClassificazioneIO non è valorizzato (ricerca in tutto il titolario) solo se il flag è 0 si intende che non si debba ricercare nelle sotto-classifiche e si mostrano solo le classifiche di 1° livello gerarchico
57        			TsRifIn				IN		VARCHAR2 DEFAULT NULL,				-- (nel formato DD/MM/RRRR HH24:MI:SS) Definisce l'istante in cui va presa la "fotografia" del titolario in cui si vuole ricercare.
58        																	-- Se non valorizzato si intende che si vuole ricercare nell'attuale titolario
59        			CriteriAvanzatiIO			IN OUT	NOCOPY CLOB,		-- XML contenente nomi e valori dei filtri sulle classificazioni (conforme allo schema SezioneCache.xsd).
60        																	-- Ogni filtro è un tag "Variabile" dell'XML
61        																	-- I filtri che sono liste hanno nomi (tag Variabile/Nome) che iniziano con @.
62        																	-- I nomi dei filtri possibili sono:
63        																	-- IdPianoClassificazione	Id. del piano di classificazione in cui restringere la ricerca
64        																	--							Se non valorizzato e non ricavabile dalla classifica CercaInClassificazioneIO si intende di dover cercare nel piano in vigore - attualmente o alla data specificata in TsRifIn - per l'Ente/AOO collegato: se non si riesce a determinare il piano in cui cercare viene dato errore
65        																	--  DesClassificazione		Stringa contenuta nella descrizione delle classifiche da cercare (ricerca case-insensitive in like senza forzare % finale)
66        																	--  LivelloGerarchico			N.ro di livello gerarchico delle classificazioni da ricercare
67        																	-- 	@CodLivelloClassif		Codici che identificano i livelli della classificazione. Ciscuna riga della lista può contenere una sola colonna:
68        																	--						1: Codice che identifica la classificazione di livello gerarchico i-esimo (dove i è il n.ro di riga) tra quelle che ricadono nella stessa classificazione padre (va espresso come si vede nella GUI, ovvero romano se previsto, 0 o -- per indicare che è assente la classificazione superiore di livello i-esimo)
69        																	--  FlgSoloClassifAttive		(valori 1/0) Se 1 si devono ricercare solo le classificazioni attive al timestamp TsRifIn, se 0 solo quelle cessate al timestamp indicato
70        																	--	DataInizioValiditaDa		Inizio intervallo di ricerca sulla data di inizio validità delle classificazioni (nel formato del parametro di config. FMT_STD_DATA)
71        																	--	DataInizioValiditaA		Fine intervallo di ricerca sulla data di inizio validità delle classificazioni (nel formato del parametro di config. FMT_STD_DATA)
72        																	--	DataFineValiditaDa		Inizio intervallo di ricerca sulla data di fine validità delle classificazioni (nel formato del parametro di config. FMT_STD_DATA)
73        																	--	DataFineValiditaA			Fine intervallo di ricerca sulla data di fine validità delle classificazioni (nel formato del parametro di config. FMT_STD_DATA)
74        																	-- FlgRichAbilXVisualizz	(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche per cui è richiesta abilitazione esplicita per visualizzare documenti e fascicoli con la data classifica (=1) o per cui non è richiesta abilitazione esplicita (=0)
75        																	-- FlgRichAbilXGest			(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche per cui è richiesta abilitazione esplicita per gestire (modificare, versionare, cancellare) documenti con la data classifica (=1) o per cui non è richiesta abilitazione esplicita (=0)
76        																	-- FlgRichAbilXAssegn		(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche per cui è richiesta abilitazione esplicita per assegnarle ad un documento (=1) o per cui non è richiesta abilitazione esplicita per assegnarle ad un documento (=0)
77        																	-- FlgRichAbilXFirma		(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche per cui è richiesta abilitazione esplicita per firmare un documento della data classifica(=1) o per cui non è richiesta abilitazione esplicita per firmare un documento della data classifica (=0)
78        																	-- FlgRichAbilXAperturaFasc	(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche per cui è richiesta abilitazione esplicita per aprirvi fascicoli (=1) o per cui non è richiesta abilitazione esplicita (=0)
79        																	-- FlgStatoAbil				(valori 1/0/NULL): filtro di ricerca per restringere la ricerca alle sole classifiche cui l'utente/UO/scrivania/profilo ecc specificato nell'argomento IdDestAbil ha (= 1) o non ha (=0) abilitazione (con le opzioni eventualmente specificate nell'argomento OpzioniAbil)
80        																	-- FlgTpDestAbil			(obblig. e gestito solo se FlgStatoAbil è valorizzato) Indica il tipo di chi (utente o UO ecc) deve avere o non avere abilitazione - con tutte le opzioni specificate in OpzioniAbilIn - verso le classifiche da ricercare
81        																								-- Valori ammessi:
82        																								--	UO	=	U.O.
83        																								-- 	SV	=	Scrivania virtuale
84        																								--	UT	=	Utente
85        																								--	PR	=	Profilo
86        																								--	GP	=	Gruppo di privilegi
87        																	-- IdDestAbil				(obblig. e gestito solo se FlgStatoAbil è valorizzato) Identificativo (ID_UO o ID_SCRIVANIA o ID_USER o ID_PROFILO o ID_GRUPPO_PRIV) di chi deve avere o non avere abilitazione - con tutte le opzioni specificate in OpzioniAbil - verso le classifiche da ricercare
88        																	-- OpzioniAbil				Indica la/le opzione (se più di una separate da ;) con cui IdDestAbilIn deve essere abilitato o meno (a seconda che FlgStatoAbil sia 1 o 0) alle classifiche da ricercare
89        																								-- Opzioni possibili:
90        																								--	M	=	a Modificare/gestire
91        																								--	A	=	ad Assegnare
92        																								--	AF	=	a Aprire Fascicoli
93        																	-- IdClassificazioneToForce: Id. di un aclassificazione da mettere nel resultset anche se non soddisfa tutti gli altri filtri
94        			CriteriPersonalizzatiIO		IN OUT 	NOCOPY CLOB,		-- Criteri di ricerca sugli attributi custom delle classificazioni (XML conforme a schema LISTA_STD.xsd). Se più di uno vengono applicati in AND.
95        																	-- Ogni criterio è un tag Riga che può contenere le seguenti colonne:
96        																	--	1) Nome (ATTR_NAME) dell'attributo cui è relativo il criterio
97        																	--	2) (obblig.) Operatore logico. Valori possibili:
98        																	--		"uguale" (ricerca esatta)
99        																	--		"simile a (case-sensitive)" (ricerca case-sensitive in like)
100        																	--		"simile a (case-insensitive)" (ricerca case-insensitive in like e che ignora i caratteri quali spazi, ., ecc)
101        																	--		"maggiore" (se attributo numerico o data)
102        																	--		"maggiore o uguale" (se attributo numerico o data)
103        																	--		"minore" (se attributo numerico o data)
104        																	--		"minore o uguale" (se attributo numerico o data)
105        																	--		"tra" (se attributo numerico o data)
106        																	--		"non valorizzato"
107        																	--		"valorizzato"
108        																	--		"spuntato" (se attributo di tipo casella di spunta)
109        																	--		"non spuntato" (se attributo di tipo casella di spunta)
110        																	--	3) 1° valore di confronto (obblig. e gestito solo se l'operatore non ha uno dei seguenti valori: valorizzato, non valorizzato, spuntato, non spuntato) (se l'attributo è numerico deve avere la virgola come separatore dei decimali, se è di tipo data deve essere in uno dei formato dati dai parametri di conf. FMT_STD_DATA e FMT_STD_TIMESTAMP)
111        																	--	4) 2° valore di confronto (obblig. e gestito solo se l'operatore è "tra") (se l'attributo è numerico deve avere la virgola come separatore dei decimali, se è di tipo data deve essere in uno dei formato dati dai parametri di conf. FMT_STD_DATA e FMT_STD_TIMESTAMP)
112        																	--	5) Label dell''attributo cui è relativo il criterio (se sotto-attributo di complesso <label del complesso> - <label del sotto-attributo>
113        			------------- inizio argomenti standard di tutte le funzioni di ricerca che devono restituire una lista --------------
114        			ColOrderByIO			IN OUT	VARCHAR2,						-- Indica il/i numeri della/e colonna dell'XML (CLOB ResultOut) di output per cui ordinare i record nell'XML stesso (si può ordinare solo per le colonne da 1 a 18 + 24 + 25). Se l'ordinamento è per più colonne queste vanno separate con "," (es: 2; 2,3)
115        																	-- in output può essere diverso che in input solo se in input è NULL: in tal caso significa che esiste sul tipo di ordinamento una qualche preimpostazione di sistema/utente ecc.
116        																	-- se non valorizzato (neppure in output) la lista di record restituita non è ordinata
117        			FlgDescOrderByIO  		IN OUT	VARCHAR2,						-- E' una stringa di 1 o 0/NULL, tanti quanti le colonne di ordinamento, separati da ",": 1 significa che l'ordinamento per la data colonna deve essere discendente anzichè ascendente (es: 1; 1,0; 1, )
118        																	-- in output può essere diverso che in input solo se in input è NULL: in tal caso significa che esiste sul verso di ordinamento una qualche preimpostazione di sistema/utente ecc.
119        			FlgSenzaPaginazioneIn 		IN 		PLS_INTEGER DEFAULT NULL,            	-- (valori 1/0/NULL) Se 1 l'estrazione non è paginata, altrimenti sì
120        			NroPaginaIO      			IN OUT	PLS_INTEGER,                  		-- E' il numero della pagina da estrarre; se NULL e l'estrazione è paginata viene estratta la prima pagina
121           			BachSizeIO				IN OUT	PLS_INTEGER,					-- Indica il massimo n.ro di record da estrarre se l'estrazione non è paginata (FlgSenzaPaginazioneIn=1)
122        																	-- Indica la dimensione (n.ro di record) della pagina se l'estrazione è paginata (FlgSenzaPaginazioneIn 0 o NULL) e in tal caso se non è valorizzato la dimensione della pagina è quella settata per l'utente di lavoro o è pari al valore del parametro STD_PAGE_NUM_ROW del dominio di lavoro
123        			OverFlowLimitIn			IN		PLS_INTEGER DEFAULT NULL,			-- E' il n.ro di record soddisfacenti la ricerca superato il quale la funzione deve restituire errore di overflow
124        			FlgSenzaTotIn			IN		PLS_INTEGER DEFAULT NULL,			-- (valori 1/0/NULL) Se 1 significa che non è richiesto come output il totale dei record soddisfacenti la ricerca (se la ricerca è paginata per la prima pagina il totale viene calcolato comunque, per le successive no)
125        			NroTotRecOut			OUT		PLS_INTEGER,					-- E' il n.ro di record complessivi trovati (valorizzato solo se FlgSenzaTotIn è 0 o NULL o se si estrae la prima pagina)
126             			NroRecInPaginaOut 		OUT   	PLS_INTEGER,                     		-- E' il numero di record nella pagina (valorizzato solo se l'estrazione è paginata, ovvero se FlgSenzaPaginazioneIn 0 o NULL)
127        			------------- fine argomenti standard di tutte le funzioni di ricerca che devono restituire una lista --------------
128        			FlgBatchSearchIn			IN		PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 significa che la stored è utilizzata da un processo batch, altrimenti da un processo online.
129        																	-- Serve affinchè in caso l'input OverFlowLimitIn non sia valorizzato vengano applicati i limiti di overflow per processo batch o online che sono parametri di configurazione del sistema.
130        			ColToReturnIn			IN		VARCHAR2 DEFAULT NULL,				-- Stringa con i n.ri delle colonne dell'XML di output ResultOut che si vuole siano presenti.
131        																	-- Se la stringa è vuota saranno presenti tutte le colonne.
132        																	-- La colonna 2 sarà presente comunque.
133        																	-- I n.ri delle varie colonne vanno separati con , o ; e se si vuole indicare un intervallo di colonne gli estremi dell'intervallo vanno separati con - (es: "1-5;7;10" significa colonne da 1 a 5 più le colonne 7 e 10)
134        			ResultOut				OUT		NOCOPY CLOB, 					-- Lista delle classificazioni trovate (XML conforme a schema LISTA_STD.xsd)
135        																	-- Ogni classificazione trovata è un tag Riga che può contenere le seguenti colonne:
136        																	-- 1:  N.ro che indica il livello gerarchico della classificazione
137        																	-- 2:  Identificativo della classificazione
138        																	-- 3:  Descrizione della classificazione
139        																	-- 4:  Tipo di classificazione (titolo, classe, sottoclasse ecc)
140        																	-- 5:  Descrizione estesa (cioè incluse le descrizioni delle classifiche superiori)
141        																	-- 6:  Parole chiave legate alla classificazione
142        																	-- 7:  Indice della classificazione (come va mostrato a GUI)
143        																	-- 8:  Data di inizio validità della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
144        																	-- 9:  Data di fine validità della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
145        																	-- 10: Cod. che identifica la classificazione in un sistema esterno di provenienza
146        																	-- 11: (valori 1/0) Se 1 la classificazione di documenti nella classificazione del record è inibita, se 0 no
147        																	-- 12: (valori 1/0) Se 1 è richiesta abilitazione esplicita per visualizzare documenti e fascicoli con la data classificazione
148        																	-- 13: (valori 1/0) Se 1 è richiesta abilitazione esplicita per gestire documenti e fascicoli con la data classificazione
149        																	-- 14: (valori 1/0) Se 1 è richiesta abilitazione esplicita per assegnare a un documento la data classificazione
150        																	-- 15: (valori 1/0) Se 1 è richiesta abilitazione esplicita per firmare documenti con la data classificazione
151        																	-- 16: (valori 1/0) Se 1 è richiesta abilitazione esplicita per aprire fascicoli nella data classificazione
152        																	-- 17: Tempo di conservazione prestabilito per gli oggetti con la data classificazione
153        																	-- 18: Supporto di conservazione prestabilito per gli oggetti con la data classificazione
154        																	-- 19: (1/0) Se 1 indica che il record è selezionabile per la finalità indicata in FinalitaIn, se 0 che non è selezionabile
155        																	-- 20: Id. della classifica superiore (valorizzata solo se questa è diversa da CercaInClassificazioneIO)
156        																	-- 21: Denominazione della classifica superiore (valorizzata solo se questa è diversa da CercaInClassificazioneIO)
157        																	-- 22: Azioni possibili sulla classificazione. E' una stringa di 1(=consentita) o 0(=non consentita) in cui ogni posizione corrisponde ad un'azione:
158        																	--	 1:  Creazione di un nuova sotto-classifica
159        																	--	 2:  Modifica
160        																	--	 3:  Cancellazione
161        																	--	 4:  Selezione (per la finalità FinalitaIn)
162        																	-- 23: (1/0) Indicatore di classificazione riservata dal sistema e non modificabile/cancellabile da applicativo
163        																	-- 24: Score del record restituito dall'indicizzatore (valori interi da 1 a 5) (valorizzato solo se effettuata ricerca full-text)
164        																	-- 25: Nri livello della classificazione (come memorizzati in DB)
165        																	-- ATTENZIONE: Se FlgIndexerOverflowIn è pari a 1, qualora la stored non vada a sua volta in overflow, dato che il resultset trovato dalla stored dovrà essere ripassato al searcher di Lucene esso non è paginato indipendentemente dal fatto che l¿apposito input lo richieda.
166        																	--		   Inoltre nel caso di FlgIndexerOverflowIn pari a 1 dato che dopo il nuovo passaggio per il searcher di Lucene si renderà necessaria una nuova chiamata alla stored solo le prime 2 colonne del clob sono valorizzate sicuramente
167        			PercorsoRicercaXMLOut		OUT		NOCOPY CLOB,					-- Lista con decodifica e id. (da quella di livello più alto in giù) delle classificazioni che compongono il percorso in cui si cerca ora (ovvero CercaInClassificazioneIO).
168        																	-- Ogni classificazione corrisponde ad un tag "Riga" con le seguenti colonne:
169        																	-- 1: Id. della classificazione
170        																	-- 2: Tipo e n.ro livello della classificazione
171        			DettagliCercaInClassifOut	OUT		NOCOPY CLOB,					-- XML contenente attributi e dati della classificazione CercaInClassificazioneIO (XML conforme a schema LISTA_STD.xsd).
172        																	-- Ogni attributo-dato è una colonna dell'unico tag Riga presente. Gli attributi-colonne sono:
173        																	-- 1:	Valore fisso 1
174        																	-- 2:	Identificativo univoco del nodo dell'albero che rappresenta la classificazione:
175        																	--    / se è l'intero titolario
176        																	--	altrimenti ID_CLASSIFICAZIONE
177        																	-- 3:	Descrizione della classificazione
178        																	-- 4: Tipo del nodo dell'albero che rappresenta la classificazione (da utilizzare per l'immagine del nodo) (titolo, classe, sottoclasse ecc)
179        																	-- 5: Dettagli sul nodo da mostrare come alt dell'immagine del nodo dell'albero che rappresenta la classificazione
180        																	-- 6:(valori 2/1/-1/0) Indica se il nodo va mostrato esploso (=2), se è esplodibile (ha "figli" in n.ro inferiore ad un limite stabilito) ma non va esploso (=1), se ha "figli" ma non è esplodibile in quanto questi superano il limite stabilito (=-1), se non è esplodibile (=0)
181        																	-- 7: N.ri livello della classificazione (come vanno mostrati nella GUI)
182        																	-- 8:(valori 1/0) Se 1 indica che la classificazione è selezionabile (quando la lista viene richiamata come lista di scelta), se 0 no
183        																	-- 9: N.ro di classifiche direttamente contenute
184        																	-- 10: N.ro di classifiche complessivamente (anche non direttamente) contenute
185        																	-- 11: Livello gerarchico della classificazione
186        																	-- 12: Id. della classifica superiore
187        																	-- 13: Denominazione della classifica superiore
188        																	-- 14: Azioni possibili sulla classificazione. E' una stringa di 1(=consentita) o 0(=non consentita) in cui ogni posizione corrisponde ad un'azione:
189        																	--	 1:  Creazione di un nuova sotto-classifica
190        																	--	 2:  Modifica
191        																	--	 3:  Cancellazione
192        																	--	 4:  Selezione (per la finalità FinalitaIn)
193        																	-- 15: Data di inizio validità della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
194        																	-- 16: Data di fine validita della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
195        																	-- 25: Flag 1/0/NULL che (se 1) indica che il numero di classifiche direttamente contenute supera il massimo consentito per esplodere la classifica come nodo dell'albero
196        			ErrContextOut			OUT		VARCHAR2,						-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
197        			ErrCodeOut				OUT		PLS_INTEGER,					-- N.ro errore di uscita
198        			ErrMsgOut				OUT 		VARCHAR2,						-- Messaggio d'errore
199        			FinalitaIn				IN		VARCHAR2 DEFAULT NULL)				-- Motivo per cui viene chiamata la pagina con la lista popolata attraverso questa funzione. Valori ammessi:
200        																	-- ASSEGNAZIONE = Per selezionare la classificazione da assegnare ad un documento
201        																	-- APERTURA_FASC = Per selezionare la classifica in cui aprire un fascicolo
202        																	-- RICERCA = Per selezionare le classifiche cui si è abilitati (per la trattazione)
203        			return PLS_INTEGER;											-- Vale 1 se tutto è andato a buon fine, altrimenti 0
204        
205        	/******* funzione per renderizzare il titolario o una sua porzione in una struttura ad albero 				*******/
206        	/******* Ogni classificazione è un nodo dell'albero.			 								*******/
207        	/******* Ogni nodo ha un identificativo univoco (l'ID_CLASSIFICAZIONE)								*******/
208        	/******* Il root node è quello di cui si rappresenta l'alberatura sottostante: 						*******/
209        	/********		se pari a / si intende l'intero titolario di classificazione 						*******/
210        	function NavigaTitolarioTree(
211        			CodIdConnectionTokenIn		IN		DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%type,
212        																	-- (obblig). Codice identificativo del token di connessione
213        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,	-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
214        			TsRifIn				IN		VARCHAR2 DEFAULT NULL,				-- (nel formato DD/MM/RRRR HH24:MI:SS) Definisce l'istante in cui va presa la "fotografia" del titolario da rappresentare tramite l'albero.
215        																	-- Se non valorizzato si intende che si vuole la fotografia attuale del titolario
216        			FlgSoloAttiveIn			IN		PLS_INTEGER DEFAULT 1,				-- (valori 1/0/NULL) Se 1 vengono estratte solo le classificazioni valide al timestamp TsRifIn
217        			IdRootNodeIO			IN OUT	VARCHAR2,				-- Identificativo del nodo root: ID_CLASSIFICAZIONE preceduto dagli ID_CLASSIFICAZIONE delle evantuali classifiche superiori (separati da /)
218        																	-- Se in input non è valorizzato si intende pari al nodo root definito nelle impostazioni personali dell'utente e se anche questo non è valorizzato si intende pari all'intero titolario (ovvero /).
219        																	-- Valori particolari sono:
220        																	-- / 		= Intero titolario
221        			IdPianoClassifIn		IN 	DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type DEFAULT NULL,
222        																	-- Id. del piano di classificazione di cui mostrare i nodi
223        																	-- può non essere specificato se IdRootNodeIO è valorizzato in input e diverso da /
224        																	-- Se non specificato e non ricavabile da IdRootNodeIO il piano che si carica è quello in vigore - attualmente o alla data specificata in TsRifIn - per l'Ente/AOO cui si è collegati (e se questo non è determinabile viene dato errore)
225        			IdNodeToExplImplIn		IN 		VARCHAR2 DEFAULT NULL,				-- Identificativo del nodo (sottostante il root) da esplodere o chiudere
226        			FlgExplodeNodeIn 			IN		PLS_INTEGER DEFAULT 1,				--(valori 1/0/NULL) se 1 significa che il nodo IdNodeToExplImplIn va esploso, se 0 o NULL il nodo IdNodeToExplImplIn va chiuso
227        			TreeXMLOut				OUT		NOCOPY CLOB,					-- Lista con i nodi dell'albero che rappresenta il titolario o una sua porzione-ramo (XML conforme a schema LISTA_STD.xsd)
228        																	-- Ogni nodo-classifica è un tag Riga che contiene le seguenti colonne:
229        																	-- 1:	Indica il livello del nodo (valori da 1 a n)
230        																	-- 2:	Identificativo univoco del nodo:
231        																	--    / se è l'intero titolario
232        																	--	altrimenti ID_CLASSIFICAZIONE preceduto dagli ID_CLASSIFICAZIONE delle evantuali classifiche superiori (separati da /)
233        																	-- 3:	Descrizione della classificazione
234        																	-- 4: Tipo di nodo (da utilizzare per l'immagine del nodo) (titolo, classe, sottoclasse ecc)
235        																	-- 5: Dettagli sul nodo da mostrare come alt dell'immagine del nodo
236        																	-- 6:(valori 2/1/-1/0) Indica se il nodo va mostrato esploso (=2), se è esplodibile (ha "figli" in n.ro inferiore ad un limite stabilito) ma non va esploso (=1), se ha "figli" ma non è esplodibile in quanto questi superano il limite stabilito (=-1), se non è esplodibile (=0)
237        																	-- 7: N.ri livello della classificazione (come vanno mostrati nella GUI)
238        																	-- 8:(valori 1/0) Se 1 indica che il nodo è selezionabile (quando l'albero viene richiamato come lista di scelta), se 0 no
239        																	-- 9: N.ro di classifiche direttamente contenute nel nodo
240        																	-- 10: N.ro di classifiche complessivamente (anche non direttamente) contenute nel nodo
241        																	-- 11: Livello gerarchico della classificazione
242        																	-- 12: Id. della classifica superiore
243        																	-- 13: Denominazione della classifica superiore
244        																	-- 14: Azioni possibili sulla classificazione. E' una stringa di 1(=consentita) o 0(=non consentita) in cui ogni posizione corrisponde ad un'azione:
245        																	--	 1:  Creazione di un nuova sotto-classifica
246        																	--	 2:  Modifica
247        																	--	 3:  Cancellazione
248        																	--	 4:  Selezione (per la finalità FinalitaIn)
249        			PercorsoRootNodeXMLOut		OUT		NOCOPY CLOB,		-- Lista con nomi e id. (da quella di livello più alto in giù) dei nodi che portano all'attuale root-node (lui incluso).
250        																	-- Ogni nodo corrisponde ad un tag "Riga" con le seguenti colonne:
251        																	-- 1: Id. del nodo
252        																	-- 2: Nome del nodo
253        																	-- 3: Id. della classifica che il nodo rappresenta
254        																	-- 4: (valori 1/0) Se 1 è un nodo non esplodibile perchè ha troppi nodi figli
255        			DettagliRootNodeOut		OUT		NOCOPY CLOB,			-- XML contenente attributi e dati del root node da mostrare nel dettaglio sopra l'albero (XML conforme a schema LISTA_STD.xsd).
256        																	-- viene restituito SOLO se il parametro compatibilty_level<=2
257        																	-- Ogni attributo-dato è una colonna dell'unico tag Riga presente. Gli attributi-colonne sono:
258        																	-- 1:	Valore fisso 1
259        																	-- 2:	Identificativo univoco del nodo:
260        																	--    / se è l'intero titolario
261        																	--	altrimenti ID_CLASSIFICAZIONE preceduto dagli ID_CLASSIFICAZIONE delle evantuali classifiche superiori (separati da /)
262        																	-- 3:	Descrizione della classificazione
263        																	-- 4: Tipo di nodo (da utilizzare per l'immagine del nodo) (titolo, classe, sottoclasse ecc)
264        																	-- 5: Dettagli sul nodo da mostrare come alt dell'immagine del nodo
265        																	-- 6:(valori 2/1/-1/0) Indica se il nodo va mostrato esploso (=2), se è esplodibile (ha "figli" in n.ro inferiore ad un limite stabilito) ma non va esploso (=1), se ha "figli" ma non è esplodibile in quanto questi superano il limite stabilito (=-1), se non è esplodibile (=0)
266        																	-- 7: N.ri livello della classificazione (come vanno mostrati nella GUI)
267        																	-- 8:(valori 1/0) Se 1 indica che il nodo è selezionabile (quando l'albero viene richiamato come lista di scelta), se 0 no
268        																	-- 9: N.ro di classifiche direttamente contenute nel nodo
269        																	-- 10: N.ro di classifiche complessivamente (anche non direttamente) contenute nel nodo
270        																	-- 11: Livello gerarchico della classificazione
271        																	-- 12: Id. della classifica superiore
272        																	-- 13: Denominazione della classifica superiore
273        																	-- 14: Azioni possibili sulla UO / relazione utente-UO. E' una stringa di 1(=consentita) o 0(=non consentita) in cui ogni posizione corrisponde ad un'azione:
274        																	--	 1:  Creazione di un nuova sotto-classifica
275        																	--	 2:  Modifica
276        																	--	 3:  Cancellazione
277        																	--	 4:  Selezione (per la finalità FinalitaIn)
278        																	-- 15: Data di inizio validità della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
279        																	-- 16: Data di fine validita della classificazione (nel formato dato dal parametro di config. FMT_STD_DATA)
280        																	-- 25: Flag 1/0 che (se 1) indica che il numero di oggetti contenuti supera il massimo consentito per esplodere il nodo
281        			ErrContextOut			OUT		VARCHAR2,				-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
282        			ErrCodeOut				OUT		PLS_INTEGER,			-- N.ro errore di uscita
283        			ErrMsgOut				OUT 		VARCHAR2,			-- Messaggio d'errore
284        			FinalitaIn				IN		VARCHAR2 DEFAULT NULL,	-- Motivo per cui viene chiamata la pagina con l'albero popolato attraverso questa funzione. Valori ammessi:
285        																	-- ASSEGNAZIONE = Per selezionare la classificazione da assegnare ad un documento
286        																	-- APERTURA_FASC = Per selezionare la classifica in cui aprire un fascicolo
287        																	-- RICERCA = Per selezionare le classifiche cui si è abilitati (per la trattazione)
288        			FlgNoDatiRootNodeIn			IN	PLS_INTEGER DEFAULT NULL
289        																	-- (valori 1/0/NULL) Se 1 indica che non serve che siano calcolati e restituiti in output PercorsoRootNodeXMLOut e DettagliRootNodeOut
290        			)
291        			return PLS_INTEGER;										-- Vale 1 se tutto è andato a buon fine, altrimenti 0
292        
293        	/******* funzione per renderizzare i nodo figli di un nodo dell'albero del titolario (i.e. una classificazione)	*******/
294        	function ExplodeTreeNode(
295        			CodIdConnectionTokenIn	IN		DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%type,
296        																	-- (obblig). Codice identificativo del token di connessione
297        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,
298        																	-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
299        			TsRifIn				IN		VARCHAR2 DEFAULT NULL,				-- (nel formato DD/MM/RRRR HH24:MI:SS) Definisce l'istante in cui va presa la "fotografia" del titolario da rappresentare tramite l'albero.
300        																	-- Se non valorizzato si intende che si vuole la fotografia attuale del titolario
301        			FlgSoloAttiveIn			IN		PLS_INTEGER DEFAULT 1,				-- (valori 1/0/NULL) Se 1 vengono estratte solo le classificazioni valide al timestamp TsRifIn
302        			IdPianoClassifIn		IN		DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type,
303        																	-- (obblig.) Identificativo del piano di classificazione cui appartiene il nodo da esplodere
304        			IdNodeToExplodeIn		IN 		VARCHAR2 DEFAULT NULL,	-- (obblig.) Identificativo del nodo da esplodere
305        			TreeXMLOut				OUT		NOCOPY CLOB,			-- Lista con i nodi figli della classifica da esplodere (XML conforme a schema LISTA_STD.xsd)
306        																	-- Ogni nodo-classifica è un tag Riga che contiene le seguenti colonne:
307        																	-- 1:	Indica il livello del nodo (valori da 1 a n)
308        																	-- 2:	Identificativo univoco del nodo:
309        																	--    / se è l'intero titolario
310        																	--	altrimenti ID_CLASSIFICAZIONE preceduto dagli ID_CLASSIFICAZIONE delle evantuali classifiche superiori (separati da /)
311        																	-- 3: Descrizione della classificazione
312        																	-- 4: Tipo di nodo (da utilizzare per l'immagine del nodo) (titolo, classe, sottoclasse ecc)
313        																	-- 5: Dettagli sul nodo da mostrare come alt dell'immagine del nodo
314        																	-- 6:(valori 2/1/-1/0) Indica se il nodo va mostrato esploso (=2), se è esplodibile (ha "figli" in n.ro inferiore ad un limite stabilito) ma non va esploso (=1), se ha "figli" ma non è esplodibile in quanto questi superano il limite stabilito (=-1), se non è esplodibile (=0)
315        																	-- 7: N.ri livello della classificazione (come vanno mostrati nella GUI)
316        																	-- 8:(valori 1/0) Se 1 indica che il nodo è selezionabile (quando l'albero viene richiamato come lista di scelta), se 0 no
317        																	-- 9: N.ro di classifiche direttamente contenute nel nodo
318        																	-- 10: N.ro di classifiche complessivamente (anche non direttamente) contenute nel nodo
319        																	-- 11: Livello gerarchico della classificazione
320        																	-- 12: Id. della classifica superiore
321        																	-- 13: Denominazione della classifica superiore
322        																	-- 14: Azioni possibili sulla classificazione. E' una stringa di 1(=consentita) o 0(=non consentita) in cui ogni posizione corrisponde ad un'azione:
323        																	--	 1:  Creazione di un nuova sotto-classifica
324        																	--	 2:  Modifica
325        																	--	 3:  Cancellazione
326        																	--	 4:  Selezione (per la finalità FinalitaIn)
327        			ErrContextOut			OUT		VARCHAR2,				-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
328        			ErrCodeOut				OUT		PLS_INTEGER,			-- N.ro errore di uscita
329        			ErrMsgOut				OUT 		VARCHAR2,			-- Messaggio d'errore
330        			FinalitaIn				IN		VARCHAR2 DEFAULT NULL	-- Motivo per cui viene chiamata la pagina con l'albero popolato attraverso questa funzione. Valori ammessi:
331        																	-- ASSEGNAZIONE = Per selezionare la classificazione da assegnare ad un documento
332        																	-- APERTURA_FASC = Per selezionare la classifica in cui aprire un fascicolo
333        																	-- RICERCA = Per selezionare le classifiche cui si è abilitati (per la trattazione)
334        			) return PLS_INTEGER;									-- Vale 1 se tutto è andato a buon fine, altrimenti 0
335        
336        	/****** funzione per ottenere l'ID_NODO del nodo che rappresenta una certa classifica nell'albero che rappresenta il piano di classificazione cui la classifica appartiene	****/
337        	function GetIdNodo (
338        			CodIdConnectionTokenIn	IN		DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%type,
339        																			-- (obblig). Codice identificativo del token di connessione
340        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,
341        																			-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
342        			IdClassificazioneIn 	IN		DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,
343        																			-- (obblig.) Id. della classificazione per cui ricavare l'ID_NODO
344        			IdNodoOut				OUT		VARCHAR2,						-- Id. nodo corrispondente alla classifica
345        			ErrContextOut			OUT		VARCHAR2,						-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
346        			ErrCodeOut				OUT		PLS_INTEGER,					-- N.ro errore di uscita
347        			ErrMsgOut				OUT 	VARCHAR2						-- Messaggio d'errore
348        			) return PLS_INTEGER;											-- Vale 1 se tutto è andato a buon fine, altrimenti 0
349        
350        	/******	funzione per sapere se i contenuti di un certo folder/classifica (quelli "direttamente" innestati nel folder) si possono listare tutti, 	*****/
351        	/*****	senza effettuare prima una ricerca, nella lista a destra della finestra di "esplora risorse" con cui si esplora il titolario				*****/
352        	/****** folder particolari: IdClassificazioneIn = NULL => "folder" dell'intero piano di classificazione il cui ID è IdPianoClassifIn in input		*****/
353        	function TestShowFolderContentAllowed(
354        			CodIdConnectionTokenIn	IN		DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%type,
355        																			-- (obblig). Codice identificativo del token di connessione
356        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,
357        																			-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
358        			IdClassificazioneIn 	IN		DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,
359        																			-- ID_CLASSIFICAZIONE del folder/classifica
360        																			-- se NON è valorizzato si intende l'intero piano di classificazione che ha come Id. il valore specificato in IdPianoClassifIn
361        			FlgShowContentAllowedOut OUT	PLS_INTEGER,					-- (valori 1/0) Se 1 significa che per il folder/classifica IdClassificazioneIn si possono mostrare come lista i contenuti
362        			ErrContextOut			OUT		VARCHAR2,						-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
363        			ErrCodeOut				OUT		PLS_INTEGER,					-- N.ro errore di uscita
364        			ErrMsgOut				OUT 	VARCHAR2,						-- Messaggio d'errore
365        			IdPianoClassifIn		IN 	DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type DEFAULT NULL,
366        																			-- Id. del piano di classificazione cui appartiene la classifica/folder
367        																			-- va specificato se IdClassificazioneIn non è valorizzato
368        																			-- Se IdClassificazioneIn non specificato e IdPianoClassifIn nemmeno si intende che il folder su cui fare la verifica è il piano in vigore - attualmente o alla data specificata in TsRifIn - per l'Ente/AOO cui si è collegati (e se questo non è determinabile viene dato errore)
369        			TsRifIn					IN		VARCHAR2 DEFAULT NULL,			-- (nel formato DD/MM/RRRR HH24:MI:SS) Definisce l'istante in cui va presa la "fotografia" del titolario su cui effettuare la verifica
370        																			-- Se non valorizzato si intende la situazione attuale del titolario
371        			FlgSoloAttiveIn			IN		PLS_INTEGER DEFAULT 1,			-- (valori 1/0/NULL) Se 1 per la verifica vengono conteggiate solo le classificazioni valide al timestamp TsRifIn
372        			FinalitaIn				IN		VARCHAR2 DEFAULT NULL			-- Motivo per cui si stanno navigando/ricercando le classifiche. Valori ammessi:
373        																			-- ASSEGNAZIONE = Per selezionare la classificazione da assegnare ad un documento
374        																			-- APERTURA_FASC = Per selezionare la classifica in cui aprire un fascicolo
375        																			-- RICERCA = Per selezionare le classifiche cui si è abilitati (per la trattazione)
376        			) return PLS_INTEGER;											-- Vale 1 se tutto è andato a buon fine, altrimenti 0
377        
378        	/****** funzione per ottenere i dati - come xml- dei livelli di un percorso che corrisponde ad una certa classifica (il cui ID è fornito in input)	****/
379        	/****** se l'ID in input, IdClassificazioneIn, è NULL si intende l'intero piano di classificazione il cui ID è IdPianoClassifIn in input			*****/
380        	function GetLivPathExClassif(
381        			CodIdConnectionTokenIn	IN		DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%type,
382        																			-- (obblig). Codice identificativo del token di connessione
383        			IdUserLavoroIn			IN		DMT_USERS.ID_USER%type DEFAULT NULL,
384        																			-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
385        			IdClassificazioneIn 	IN		DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,
386        																			-- ID_CLASSIFICAZIONE della classificazione di cui determinare i livelli del percorso corrispondente
387        			PercorsoXMLOut			OUT	NOCOPY CLOB,						-- Lista con i dati dei livelli del percorso corrispondente al folder
388        																			-- Ogni cartella/folder nel percorso corrisponde ad un tag "Riga" con le seguenti colonne:
389        																			-- 1: Id. classificazione corrispondente al livello
390        																			-- 2: Nome
391        																			-- 3: (valori 1/0) Se 1 nell'albero del titolario il folder è un nodo di cui NON si possono mostrare tutti contenuti
392        			FlgShowContentAllowedOut OUT	PLS_INTEGER,					-- (valori 1/0) Se 1 significa che per il folder IdClassificazioneIn si possono mostrare come lista i contenuti
393        																			-- concide sempre con la colonna 3 dell'ultima riga di PercorsoXMLOut
394        			ErrContextOut			OUT		VARCHAR2,						-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
395        			ErrCodeOut				OUT		PLS_INTEGER,					-- N.ro errore di uscita
396        			ErrMsgOut				OUT 	VARCHAR2,						-- Messaggio d'errore
397        			IdPianoClassifIn		IN 	DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type DEFAULT NULL,
398        																			-- Id. del piano di classificazione cui appartiene la classifica/folder
399        																			-- va specificato se IdClassificazioneIn non è valorizzato
400        																			-- Se IdClassificazioneIn non specificato e IdPianoClassifIn nemmeno si intende che il folder su cui fare la verifica è il piano in vigore - attualmente o alla data specificata in TsRifIn - per l'Ente/AOO cui si è collegati (e se questo non è determinabile viene dato errore)
401        			TsRifIn					IN		VARCHAR2 DEFAULT NULL,			-- (nel formato DD/MM/RRRR HH24:MI:SS) Definisce l'istante in cui va presa la "fotografia" del titolario
402        																			-- Se non valorizzato si intende la situazione attuale del titolario
403        																			-- serve per determinare la colonna 3 dei livelli del percorso restituiti in PercorsoXMLOut
404        			FlgSoloAttiveIn			IN		PLS_INTEGER DEFAULT 1,			-- (valori 1/0/NULL) Se 1 per determinare la colonna 3 dei livelli del percorso restituiti in PercorsoXMLOut vengono conteggiate solo le classificazioni valide al timestamp TsRifIn
405        			FinalitaIn				IN		VARCHAR2 DEFAULT NULL			-- Motivo per cui si stanno navigando/ricercando le classifiche. Valori ammessi:
406        																			-- ASSEGNAZIONE = Per selezionare la classificazione da assegnare ad un documento
407        																			-- APERTURA_FASC = Per selezionare la classifica in cui aprire un fascicolo
408        																			-- RICERCA = Per selezionare le classifiche cui si è abilitati (per la trattazione)
409        																			-- serve per determinare la colonna 3 dei livelli del percorso restituiti in PercorsoXMLOut
410        			) return PLS_INTEGER;											-- Vale 1 se tutto è andato a buon fine, altrimenti 0
411        
412        	procedure AggiornaClassifInibita(
413        			IdPianoClassifIn		IN		DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type DEFAULT NULL);
414        																			-- Id. del piano di classificazione di cui aggiornare i flg_classif_inibita
415        																			-- se non valorizzato vengono aggiornati tutti i piani
416        
417        	---- funzione per ricercare i piani di classificazione
418        	---- se si è collegati al dominio trasversale a tutti i produttori (tipo dominio = 1)
419        	---- mostra tutti i piani dei vari produttori
420        	---- se si è collegati al dominio di un ente con più AOO
421        	---- mostra tutti i piani delle varie AOO dell'ente
422        	---- altrimenti mostra solo i piani associati al dato produttore/AOO cui si è collegati
423        	function TrovaPianiClassif (
424        		CodIdConnectionTokenIn		IN	    DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
425        																					-- (obblig). Codice identificativo del token di connessione
426        		IdUserLavoroIn				IN		DMT_USERS.ID_USER%type DEFAULT NULL,	-- Id.(ID_USER della DMT_USERS) dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
427        		FiltriIO					IN OUT	NOCOPY CLOB,							-- XML contenente nomi e valori dei filtri di ricerca (conforme allo schema SezioneCache.xsd).
428        																					-- Ogni filtro è un tag "Variabile" dell'XML
429        																					-- I nomi dei filtri possibili sono:
430        																					-- IdDomini: ID_SP_AOO del soggetto produttore/AOO cui devono essere associati i piani da trovare (direttamente o per il tramite della classe del soggetto produttore/AOO)
431        																					-- si possono specificare più domini separandoli con , o ;
432        																					-- IdClassiDomini: ID della classe di soggetto produttore/AOO cui devono essere associati i piani
433        																					-- si possono specificare più classi separandole con , o ;
434        																					-- AdozioneDal: estremo inferiore della data di adozione espressa nel formato dato dal parametro di config. FMT_STD_DATA
435        																					-- AdozioneAl: estremo superiore della data di adozione espressa nel formato dato dal parametro di config. FMT_STD_DATA
436        																					-- DismissioneDal: estremo inferiore della data di dismissione espressa nel formato dato dal parametro di config. FMT_STD_DATA
437        																					-- DismissioneAl: estremo superiore della data di dismission espressa nel formato dato dal parametro di config. FMT_STD_DATA
438        																					-- Stati: valori possibili: attivo; da_attivare; dismesso
439        																					-- si può specificare più stati separandoli con , o ;
440        		------------- inizio argomenti standard di tutte le funzioni di ricerca che devono restituire una lista --------------
441        		ColOrderByIO				IN OUT	VARCHAR2,								-- Indica il/i numeri della/e colonna dell'XML (CLOB ResultOut) di output per cui ordinare i record nell'XML stesso (si può ordinare solo per le colonne da 1 a 8). Se l'ordinamento è per più colonne queste vanno separate con "," (es: 2; 2,3)
442        																					-- in output può essere diverso che in input solo se in input è NULL: in tal caso significa che esiste sul tipo di ordinamento una qualche preimpostazione di sistema/utente ecc.
443        																					-- se non valorizzato (neppure in output) la lista di record restituita non è ordinata
444        		FlgDescOrderByIO  			IN OUT	VARCHAR2,								-- E' una stringa di 1 o 0/NULL, tanti quanti le colonne di ordinamento, separati da ",": 1 significa che l'ordinamento per la data colonna deve essere discendente anzichè ascendente (es: 1; 1,0; 1, )
445        																					-- in output può essere diverso che in input solo se in input è NULL: in tal caso significa che esiste sul verso di ordinamento una qualche preimpostazione di sistema/utente ecc.
446        		FlgSenzaPaginazioneIn 		IN 		PLS_INTEGER DEFAULT NULL,            	-- (valori 1/0/NULL) Se 1 l'estrazione non è paginata, altrimenti sì
447        		NroPaginaIO      			IN OUT	PLS_INTEGER,                  			-- E' il numero della pagina da estrarre; se NULL e l'estrazione è paginata viene estratta la prima pagina
448        		BachSizeIO					IN OUT	PLS_INTEGER,							-- Indica il massimo n.ro di record da estrarre se l'estrazione non è paginata (FlgSenzaPaginazioneIn=1)
449        																					-- Indica la dimensione (n.ro di record) della pagina se l'estrazione è paginata (FlgSenzaPaginazioneIn 0 o NULL) e in tal caso se non è valorizzato la dimensione della pagina è quella settata per l'utente di lavoro o è pari al valore del parametro STD_PAGE_NUM_ROW del dominio di lavoro
450        		OverFlowLimitIn				IN		PLS_INTEGER DEFAULT NULL,				-- E' il n.ro di record soddisfacenti la ricerca superato il quale la funzione deve restituire errore di overflow
451        		FlgSenzaTotIn				IN		PLS_INTEGER DEFAULT NULL,				-- (valori 1/0/NULL) Se 1 significa che non è richiesto come output il totale dei record soddisfacenti la ricerca (se la ricerca è paginata per la prima pagina il totale viene calcolato comunque, per le successive no)
452        		NroTotRecOut				OUT		PLS_INTEGER,							-- E' il n.ro di record complessivi trovati (valorizzato solo se FlgSenzaTotIn è 0 o NULL o se si estrae la prima pagina)
453        		NroRecInPaginaOut 			OUT   	PLS_INTEGER,                     		-- E' il numero di record nella pagina (valorizzato solo se l'estrazione è paginata, ovvero se FlgSenzaPaginazioneIn 0 o NULL)
454        		------------- fine argomenti standard di tutte le funzioni di ricerca che devono restituire una lista --------------
455        		FlgBatchSearchIn			IN		PLS_INTEGER DEFAULT NULL,				-- (valori 1/0/NULL) Se 1 significa che la stored è utilizzata da un processo batch, altrimenti da un processo online.
456        																					-- Serve affinchè in caso l'input OverFlowLimitIn non sia valorizzato vengano applicati i limiti di overflow per processo batch o online che sono parametri di configurazione del sistema.
457        		ColToReturnIn				IN		VARCHAR2 DEFAULT NULL,					-- Stringa con i n.ri delle colonne dell'XML di output ResultOut che si vuole siano presenti.
458        																					-- Se la stringa è vuota saranno presenti tutte le colonne.
459        																					-- La colonna 1 sarà presente comunque.
460        																					-- I n.ri delle varie colonne vanno separati con , o ; e se si vuole indicare un intervallo di colonne gli estremi dell'intervallo vanno separati con - (es: "1-5;7;10" significa colonne da 1 a 5 più le colonne 7 e 10)
461        		ResultOut					OUT		NOCOPY CLOB, 							-- Lista dei piani trovati (XML conforme a schema LISTA_STD.xsd)
462        																					-- Ogni piano trovatoa è un tag Riga che può contenere le seguenti colonne:
463        																					-- 1:  ID (PK interna)
464        																					-- 2:  Id. del soggetto produttore/AOO o classe di soggetti produttori/AOO cui è associato il piano
465        																					-- 3:  Denominazione/descrizione del soggetto produttore/AOO o classe di soggetti produttori/AOO cui è associato il piano
466        																					-- 4:  Stato (valori: attivo; da_attivare; dismesso)
467        																					-- 5:  Data di attivazione (nel formato dato dal parametro di config. FMT_STD_DATA)
468        																					-- 6:  Data di dismissione (nel formato dato dal parametro di config. FMT_STD_DATA)
469        																					-- 7:  Note
470        																					-- 8:  Cod. di provenienza (su sistema esterno che gestisce i piani)
471        																					-- 9:  Nro di livelli definiti nel piano
472        																					-- 10: Nomi e metriche dei livelli definiti nel piano
473        																					-- 11: Data e ora di inserimento (nel formato dato dal parametro di configurazione FMT_STD_TIMESTAMP)
474        																					-- 12: Utente di inserimento (decodifica)
475        																					-- 13: Data e ora di ultimo aggiornamento (nel formato dato dal parametro di configurazione FMT_STD_TIMESTAMP)
476        		ErrContextOut				OUT		VARCHAR2,								-- 14: Utente di ultimo aggiornamento (decodifica)
477        																					-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
478        		ErrCodeOut					OUT		PLS_INTEGER,							-- N.ro errore di uscita
479        		ErrMsgOut					OUT 		VARCHAR2)							-- Messaggio d'errore
480        		return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine, altrimenti 0
481        
482        	---- funzione per creare o modificare un piano di classificazione
483        	function IUPianoClassif(
484        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
485        																						-- (obblig). Codice identificativo del token di connessione
486        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
487        		IdPianoClassifIO		IN OUT		DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type ,	-- Id. del piano da modificare. Se NULL si intende che il piano è da creare ex-novo
488        																						-- in output, salvo in caso di errore, è sempre valorizzato
489        		DtAdozioneIn			IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'DATE_VAL_NO_UPD'),
490        																						-- (obblig.)Data di adozione del piano (nel formato dato dal parametro di conf. FMT_STD_DATA).
491        		DtDismissioneIn			IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'DATE_VAL_NO_UPD'),
492        																						-- Data di dismissione del piano (nel formato dato dal parametro di conf. FMT_STD_DATA).
493        		NoteIn					IN			DMT_PIANI_CLASSIF.NOTE%type DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
494        																						-- Note
495        		ProvCIPianoIn			IN			DMT_PIANI_CLASSIF.PROV_CI_PIANO%type DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
496        																						-- Codice identificativo del piano nel sistema preposto a gestire i piani (se diverso da Auriga)
497        		FlgModLivelliPianoIn	IN			VARCHAR2 DEFAULT 'I',						-- (valori I/C) Indica se i livelli del piano indicati nell'argomento successivo sono forniti in modo incrementale (=I) (solo quelle da inserire/cancellare) oppure completo (=C), vale a dire che dovranno soppiantare tutti quelli già associati al piano
498        		XMLLivelliPianoIn		IN			CLOB,										-- Lista con i dati dei livelli definiti nel piano
499        																						-- Ogni livello è un tag "Riga" che può contenere le seguenti colonne:
500        																						-- 1: (obblig) Cardinalità del livello (nri da 1 in su)
501        																						-- 2: (obblig salvo se livello da eiminare, ovvero se colonna 5 = 1)Nome delle classifiche del dato livello
502        																						-- 3: (valori 1/0/NULL) Se 1 i codici delle classifiche di quel livello sono n.ri interi, altrimenti sono alfanumerici
503        																						-- 4: (valori 1/0/NULL) Se 1 i codici delle classifiche di quel livello sono rappresentati come n.ri romani
504        																						-- 5: (valori 1/0/NULL) Se 1 significa che è un livello già salvato da eliminare
505        		FlgIgnoreWarningIn 		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 0 o NULL significa che in presenza di WARNING la stored si comporta come in caso di errore; se 1 gli WARNING vengono ignorati
506        		FlgRollBckFullIn		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 in caso di errore viene fatta la rollback completa (non a savepoint), altrimenti la rollback delle sole modifiche effettuate nella stored
507        																						-- ATTENZIONE: La rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log
508        		FlgAutoCommitIn			IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se vale 1, dopo la rollback e qualunque sia l'esito (positivo o meno), la funzione esegue una commit finale
509        		WarningMsgOut			OUT			VARCHAR2,									-- Messaggio di warning (valorizzato solo se non c'è errore)
510        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
511        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
512        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
513        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine (senza warning), altrimenti 0 (in caso di errore o warning)
514        
515        	---- funzione per eliminare un piano di classificazione (solo se ancora non utilizzato)
516        	function DPianoClassif(
517        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
518        																						-- (obblig). Codice identificativo del token di connessione
519        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
520        		IdPianoClassifIn		IN 			DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type ,	-- (obblig.) Id. del piano da eliminare
521        		MotiviIn				IN			DMT_ACTIVITIES.NOTE%type,					-- Motivi della cancellazione
522        		FlgIgnoreWarningIn 		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 0 o NULL significa che in presenza di WARNING la stored si comporta come in caso di errore; se 1 gli WARNING vengono ignorati
523        		FlgRollBckFullIn		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 in caso di errore viene fatta la rollback completa (non a savepoint), altrimenti la rollback delle sole modifiche effettuate nella stored
524        																						-- ATTENZIONE: La rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log
525        		FlgAutoCommitIn			IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se vale 1, dopo la rollback e qualunque sia l'esito (positivo o meno), la funzione esegue una commit finale
526        		WarningMsgOut			OUT			VARCHAR2,									-- Messaggio di warning (valorizzato solo se non c'è errore)
527        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
528        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
529        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
530        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine (senza warning), altrimenti 0 (in caso di errore o warning)
531        
532        	---- funzione per caricare i dati di un piano di classificazione
533        	function LoadDettPianoClassif(
534        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
535        																						-- (obblig). Codice identificativo del token di connessione
536        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
537        		IdPianoClassifIn		IN 			DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type ,	-- (obblig.) Id. del piano di cui caricare i dati
538        		DtAdozioneOut			OUT			VARCHAR2,									-- Data di adozione del piano (nel formato dato dal parametro di conf. FMT_STD_DATA).
539        		DtDismissioneOut		OUT			VARCHAR2,									-- Data di dismissione del piano (nel formato dato dal parametro di conf. FMT_STD_DATA).
540        		NoteOut					OUT			DMT_PIANI_CLASSIF.NOTE%type,				-- Note
541        		ProvCIPianoOut			OUT			DMT_PIANI_CLASSIF.PROV_CI_PIANO%type,		-- Codice identificativo del piano nel sistema preposto a gestire i piani (se diverso da Auriga)
542        		XMLLivelliPianoOut		OUT NOCOPY	CLOB,										-- Lista con i dati dei livelli definiti nel piano
543        																						-- Ogni livello è un tag "Riga" con le seguenti colonne:
544        																						-- 1: Cardinalità del livello (nri da 1 in su)
545        																						-- 2: Nome delle classifiche del dato livello
546        																						-- 3: (valori 1/0) Se 1 i codici delle classifiche di quel livello sono n.ri interi, altrimenti sono alfanumerici
547        																						-- 4: (valori 1/0) Se 1 i codici delle classifiche di quel livello sono rappresentati come n.ri romani
548        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
549        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
550        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
551        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine , altrimenti 0 (in caso di errore)
552        
553        	---- funzione per creare nell'archivio di un soggetto produttore/AOO tutti i folder relativi al piano di classificazione e classifiche in esso contenute
554        	function CreaFolderPianoClassif(
555        		IdPianoClassifIn		IN 			DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type,	-- (obblig.) Id. del piano
556        		IdSpAOOIn				IN 			DMT_SOGGETTI_PROD_AOO.ID_SP_AOO%type,		-- (obblig.) Id. del soggetto produttore/AOO
557        		FlgRollBckFullIn		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 in caso di errore viene fatta la rollback completa (non a savepoint), altrimenti la rollback delle sole modifiche effettuate nella stored
558        																						-- ATTENZIONE: La rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log
559        		FlgAutoCommitIn			IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se vale 1, dopo la rollback e qualunque sia l'esito (positivo o meno), la funzione esegue una commit finale
560        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
561        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
562        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
563        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine, altrimenti 0 (in caso di errore)
564        
565        	---  funzione per creare o modificare una classifica
566        	function IUClassifica(
567        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
568        																						-- (obblig). Codice identificativo del token di connessione
569        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
570        		IdPianoClassifIn		IN			DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type ,	-- Id. del piano in cui inserire la classifica.
571        																						-- Deve essere obbligatoriamente valorizzato in caso di inserimento
572        																						-- Viene invece ignorato in caso di modifica
573        		IdClassificazioneIO		IN	OUT		DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,		-- Id. della classifica da modificare. Se NULL si intende che la classifica è da creare ex-novo
574        																						-- in output, salvo in caso di errore, è sempre valorizzato
575        		IdClassificazioneSupIn	IN			DMT_TITOLARIO.ID_CLASSIFICAZIONE%type DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
576        																						-- Id.della classifica superiore. Se non valorizzato (e non lo è neppure NriLivelliClassifSupIn) significa che è una classifica di primo livello
577        		NriLivelliClassifSupIn	IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
578        																						-- N.ri livelli della classifica superiore. Se non valorizzato (e non lo è neppure IdClassificazioneSupIn) significa che è una classifica di primo livello
579        																						-- I nri vanno indicati così come appaiono nella GUI e con il separatore previsto nella GUI per i livelli di classifica
580        		NroLivelloIn			IN 			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
581        																						-- (obblig.) N.ro livello (come appare nella GUI, ovvero romano se previsto) che identifica la classifica tra quelle dello stesso livello gerarchico (sottostanti la stessa IdClassificazioneSupIn se specificata)
582        		DesClassificazioneIn	IN			DMT_TITOLARIO.DES_CLASSIFICAZIONE%type DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
583        																						-- (obblig.) Descrizione della classificazione
584        		DtInizioVldIn			IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'DATE_VAL_NO_UPD'),
585        																						-- (obblig.)Data di inizio validità (nel formato dato dal parametro di conf. FMT_STD_DATA).
586        		DtFineVldIn				IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'DATE_VAL_NO_UPD'),
587        																						-- Data di fine validità (nel formato dato dal parametro di conf. FMT_STD_DATA).
588        		ParoleChiaveIn			IN			DMT_TITOLARIO.PAROLE_CHIAVE%type DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
589        																						-- Parole chiave associate alla classificazione
590        		NroPosizioneIn			IN			DMT_TITOLARIO.NRO_POSIZIONE%type DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
591        																						-- N.ro che serve a stabilire la posizione della classifica nel piano (per avere un ordinamento alternativo a quello dato dai livelli)
592        		CodSupportoConservIn	IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
593        																						-- Codice (censito in dizionario) che identifica il supporto su cui generalmente è conservata la documentazione della data classifica (cartaceo, digitale ecc)
594        		DesSupportoConservIn	IN			VARCHAR2 DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
595        																						-- Nome del supporto (censito in dizionario) su cui generalmente è conservata la documentazione della data classifica (cartaceo, digitale ecc)
596        		FlgConservPermanenteIn	IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
597        																						-- (valori 1/0/NULL) Se 1 significa che in generale la documentazione della data classifica deve essere conservata per tempo illimitato
598        		PeriodoConservazioneIn	IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
599        																						-- Periodo - espresso in anni - per cui conservare la documentazione della data classifica (salvo eccezioni)
600        		FlgFolderizzaXAnnoIn	IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
601        																						-- (valori 1/0/NULL) Se 1 significa che i fascicoli con la data classifica vengono folderizzati in automatico per anno (un folder per anno all'interno di quello che corrisponde alla classifica)
602        		FlgRichAbilXVisIn		IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
603        																						-- (valori 1/0/NULL) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter visualizzare la documentazione ad essa afferente
604        		FlgRichAbilXGestIn		IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
605        																						-- (valori 1/0/NULL) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter lavorare la documentazione ad essa afferente
606        		FlgRichAbilXFirmaIn		IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
607        																						-- (valori 1/0/NULL) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter firmare la documentazione ad essa afferente
608        		FlgRichAbilXAssegnIn	IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
609        																						-- (valori 1/0/NULL) Se 1 significa che serve un'abilitazione esplicita alla classificazione per potervi classificare dei documenti
610        		FlgRichAbilXAperFascIn	IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
611        																						-- (valori 1/0/NULL) Se 1 significa che serve un'abilitazione esplicita alla classificazione per potervi aprire dei fascicoli
612        		FlgClassifInibitaIn		IN			PLS_INTEGER	DEFAULT dmpk_utility.GetValConfigParamNumber(1, NULL, 'NUM_VAL_NO_UPD'),
613        																						-- (valori 1/0/NULL) Se 1 significa che non è consentito classificare documentazione e aprire fascicoli direttamente nella classifica (solo in sue sotto-voci)
614        		ProvCIClassifIn			IN			DMT_TITOLARIO.PROV_CI_CLASSIFICAZIONE%type DEFAULT dmpk_utility.GetValConfigParamText(1, NULL, 'STR_VAL_NO_UPD'),
615        																						-- Codice identificativo del piano nel sistema preposto a gestire i piani (se diverso da Auriga)
616        		FlgModTemplateXFascIn	IN			VARCHAR2 DEFAULT 'I',						-- (valori I/C) Indica se i template di nome fascicolo della data classifica indicati nell'argomento successivo sono forniti in modo incrementale (=I) (solo quelle da inserire/cancellare) oppure completo (=C), vale a dire che dovranno soppiantare tutti quelli già associati alla classifica
617        		XMLTemplateXFascIn		IN			CLOB,										-- Lista con i template di nome fascicolo della data classifica
618        																						-- Ogni template è un tag "Riga" che può contenere le seguenti colonne:
619        																						-- 1: (obblig) Template
620        																						-- 2: (valori 1/0/NULL) Se 1 significa che è un template già salvato da eliminare
621        		RowidOut				OUT			VARCHAR2,									-- Rowid del record della classifica
622        		AttributiAddIn			IN			CLOB DEFAULT NULL,							-- XML contenente nomi e valori degli attributi dinamici da aggiornare (conforme allo schema SezioneCache.xsd)
623        																						-- Gli attributi già presenti in DB e per i quali non c'è corrispondente nell'XML restano invariati
624        																						-- Per tutti gli attributi vale quanto segue:
625        																						-- Un attributo da settare è un tag "Variabile" dell'XML il cui tag "Nome" contiene il nome identificativo dell'attributo (ATTR_NAME di DMT_ATTRIBUTES_DEF)
626        																						-- Un attributo da settare è una variabile con tag "ValoreSemplice" se è un attributo a singolo valore e non strutturato (cioè con tipo diverso da COMPLEX)
627        																						-- altrimenti è una variabile con tag "Lista" che ha un'unica colonna con "Nro" pari a 1 se l'attributo non è strutturato, che ha invece tante colonne quanti gli attributi componenti (ordinate in base al loro NRO_ORD_IN_SUP) se l'attributo è complesso
628        																						-- Nel caso di variabili con tag "Lista" i valori specificati nell'XML si aggiungono o sostituiscono quelli già presenti in DB a seconda che nell'XML sia presente o meno una variabile con tag "Nome" pari a #Append_<Nome attributo> e tag "ValoreSemplice" pari a 1
629        																						-- In particolare se non sono specificati valori nell'XML (tag Lista vuoto) e se i valori non sono da aggiungere significa che tutti i valori dell'attributo già presenti in DB vanno rimossi
630        		FlgStoricizzaDatiIn		IN			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0) Se 1 i dati variati veranno storicizzati
631        		TsVariazioneDatiIn		IN			VARCHAR2 DEFAULT NULL,						-- (gestito solo se FlgStoricizzaDatiIn=1) Timestamp a cui risale la variazione dei dati (nel formato dato dal parametro di configurazione FMT_STD_TIMESTAMP).
632        																						-- Se non valorizzato e se FlgStoricizzaDatiIn si intende che la variazione decorra da data e ora corrente
633        		MotiviVariazioneIn		IN			VARCHAR2 DEFAULT NULL,						-- Motivo della variazione dei dati
634        		FlgDatiDaStoricizzareOut	OUT		PLS_INTEGER,								-- (valori 1/NULL) Se FlgStoricizzaDatiIn non è valorizzato e se si sono modificati dati che è previsto storicizzare viene restituito pari a 1
635        		FlgIgnoreWarningIn 		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 0 o NULL significa che in presenza di WARNING la stored si comporta come in caso di errore; se 1 gli WARNING vengono ignorati
636        		FlgRollBckFullIn		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 in caso di errore viene fatta la rollback completa (non a savepoint), altrimenti la rollback delle sole modifiche effettuate nella stored
637        																						-- ATTENZIONE: La rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log
638        		FlgAutoCommitIn			IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se vale 1, dopo la rollback e qualunque sia l'esito (positivo o meno), la funzione esegue una commit finale
639        		WarningMsgOut			OUT			VARCHAR2,									-- Messaggio di warning (valorizzato solo se non c'è errore)
640        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
641        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
642        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
643        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine (senza warning), altrimenti 0 (in caso di errore o warning)
644        
645        	---- funzione per eliminare fisicamente una classificazione (solo se ancora non utilizzata)
646        	function DClassifica(
647        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
648        																						-- (obblig). Codice identificativo del token di connessione
649        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
650        		IdClassificazioneIn		IN 			DMT_TITOLARIO.ID_CLASSIFICAZIONE%type ,		-- (obblig.) Id. della classificazione da eliminare
651        		MotiviIn				IN			DMT_ACTIVITIES.NOTE%type,					-- Motivi della cancellazione
652        		FlgIgnoreWarningIn 		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 0 o NULL significa che in presenza di WARNING la stored si comporta come in caso di errore; se 1 gli WARNING vengono ignorati
653        		FlgRollBckFullIn		IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se 1 in caso di errore viene fatta la rollback completa (non a savepoint), altrimenti la rollback delle sole modifiche effettuate nella stored
654        																						-- ATTENZIONE: La rollback, di qualsiasi tipo, non riguarda la scrittura di eventuali log
655        		FlgAutoCommitIn			IN 			PLS_INTEGER DEFAULT NULL,					-- (valori 1/0/NULL) Se vale 1, dopo la rollback e qualunque sia l'esito (positivo o meno), la funzione esegue una commit finale
656        		WarningMsgOut			OUT			VARCHAR2,									-- Messaggio di warning (valorizzato solo se non c'è errore)
657        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
658        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
659        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
660        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine (senza warning), altrimenti 0 (in caso di errore o warning)
661        
662        
663        	---- funzione per caricare i dati di una classificazione
664        	function LoadDettClassifica(
665        		CodIdConnectionTokenIn	IN	    	DMT_CONNECTION_TOKEN.CI_CONNECTION_TOKEN%TYPE,
666        																						-- (obblig). Codice identificativo del token di connessione
667        		IdUserLavoroIn			IN			DMT_USERS.ID_USER%type DEFAULT NULL,		-- Id. dell'utente a nome di cui si lavora. Se non valorizzato è l'utente connesso
668        		IdClassificazioneIn		IN 			DMT_TITOLARIO.ID_CLASSIFICAZIONE%type ,		-- (obblig.) Id. della classificazione di cui caricare i dati
669        		IdPianoClassifOut		OUT			DMT_PIANI_CLASSIF.ID_PIANO_CLASSIF%type ,	-- Id. del piano di appartenenza
670        		IdClassificazioneSupOut	OUT			DMT_TITOLARIO.ID_CLASSIFICAZIONE%type,		-- Id.della classifica superiore. Se non valorizzato significa che è una classifica di primo livello
671        		NriLivelliClassifSupOut	OUT			VARCHAR2,									-- N.ri livelli della classifica superiore. Se non valorizzato significa che è una classifica di primo livello
672        																						-- I nri sono indicati così come appaiono nella GUI e con il separatore previsto nella GUI per i livelli di classifica
673        		NroLivelloOut			OUT 		VARCHAR2,									-- N.ro livello (come appare nella GUI, ovvero romano se previsto) che identifica la classifica tra quelle dello stesso livello gerarchico (sottostanti la stessa IdClassificazioneSupOut se presente)
674        		DesClassificazioneOut	OUT			DMT_TITOLARIO.DES_CLASSIFICAZIONE%type,		-- Descrizione della classificazione
675        		DtInizioVldOut			OUT			VARCHAR2,									-- Data di inizio validità (nel formato dato dal parametro di conf. FMT_STD_DATA).
676        		DtFineVldOut			OUT			VARCHAR2,									-- Data di fine validità (nel formato dato dal parametro di conf. FMT_STD_DATA).
677        		ParoleChiaveOut			OUT			DMT_TITOLARIO.PAROLE_CHIAVE%type,			-- Parole chiave associate alla classificazione
678        		NroPosizioneOut			OUT			DMT_TITOLARIO.NRO_POSIZIONE%type,			-- N.ro che serve a stabilire la posizione della classifica nel piano (per avere un ordinamento alternativo a quello dato dai livelli)
679        		CodSupportoConservOut	OUT			VARCHAR2,									-- Codice (censito in dizionario) che identifica il supporto su cui generalmente è conservata la documentazione della data classifica (cartaceo, digitale ecc)
680        		DesSupportoConservOut	OUT			VARCHAR2,									-- Nome del supporto (censito in dizionario) su cui generalmente è conservata la documentazione della data classifica (cartaceo, digitale ecc)
681        		FlgConservPermanenteOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che in generale la documentazione della data classifica deve essere conservata per tempo illimitato
682        		PeriodoConservazionOut	OUT			PLS_INTEGER,								-- Periodo - espresso in anni - per cui conservare la documentazione della data classifica (salvo eccezioni)
683        		FlgFolderizzaXAnnoOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che i fascicoli con la data classifica vengono folderizzati in automatico per anno (un folder per anno all'interno di quello che corrisponde alla classifica)
684        		FlgRichAbilXVisOut		OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter visualizzare la documentazione ad essa afferente
685        		FlgRichAbilXGestOut		OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter lavorare la documentazione ad essa afferente
686        		FlgRichAbilXFirmaOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che serve un'abilitazione esplicita alla classificazione per poter firmare la documentazione ad essa afferente
687        		FlgRichAbilXAssegnOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che serve un'abilitazione esplicita alla classificazione per potervi classificare dei documenti
688        		FlgRichAbilXAperFascOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che serve un'abilitazione esplicita alla classificazione per potervi aprire dei fascicoli
689        		FlgClassifInibitaOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 significa che non è consentito classificare documentazione e aprire fascicoli direttamente nella classifica (solo in sue sotto-voci)
690        		ProvCIClassifOut		OUT			DMT_TITOLARIO.PROV_CI_CLASSIFICAZIONE%type,	-- Codice identificativo del piano nel sistema preposto a gestire i piani (se diverso da Auriga)
691        		XMLTemplateXFascOut		OUT			NOCOPY CLOB,								-- Lista con i template di nome fascicolo della data classifica
692        																						-- Ogni template è un tag "Riga" che contiene le seguenti colonne:
693        																						-- 1: Template
694        		RowidOut				OUT			VARCHAR2,									-- Rowid del record della classifica
695        		AttributiAddOut			OUT			NOCOPY CLOB,								-- Lista degli eventuali ulteriori attributi con cui caratterizzare la classifica (XML conforme a schema LISTA_STD.xsd)
696        																						-- Ogni attributo è un tag "Riga" che contiene le seguenti colonne:
697        																						-- 1: N.ro (valori da 1 a n) del riquadro (fieldset) in cui mostrare l'attributo
698        																						-- 2: Nome identificativo dell'attributo (ATTR_NAME)
699        																						-- 3: Label del campo con cui rappresentare l'attributo
700        																						-- 4: Tipo di attributo. Valori: DATE, DATETIME, TEXT, TEXT-AREA, CHECK, INTEGER, EURO, DECIMAL, COMBO-BOX, LISTA
701        																						-- 5: N.ro massimo di caratteri/cifre
702        																						-- 6: Larghezza del campo con cui rappresentare l'attributo (size)
703        																						-- 7: Valore dell'attributo
704        																						-- 8: Label del riquadro (fieldset) in cui mostrare l'attributo
705        																						-- 9: (valori 1/0) 1 indica che l'attributo è obbligatorio, 0 che è facoltativo
706        																						-- 10: Altezza (in nro righe) del campo con cui rappresentare l'attributo (se TEXT-AREA)
707        																						-- 11:(valori 1/0) 1 indica se l'attributo è modificabile, 0 che è in sola visualizzazione
708        		FlgMostraAltriAttrOut	OUT			PLS_INTEGER,								-- (valori 1/0) Se 1 nella GUI vanno mostrati gli attributi addizionali (ce ne sono di visibile all'utente), se 0 no
709        		ErrContextOut			OUT			VARCHAR2,									-- Contesto (ovvero package e/o funzione/procedura) in cui si è verificato l'errore
710        		ErrCodeOut				OUT			PLS_INTEGER,								-- N.ro errore di uscita
711        		ErrMsgOut				OUT 		VARCHAR2									-- Messaggio d'errore
712        		) return PLS_INTEGER;															-- Vale 1 se tutto è andato a buon fine , altrimenti 0 (in caso di errore)
713        
714        
715        END DMPK_TITOLARIO;